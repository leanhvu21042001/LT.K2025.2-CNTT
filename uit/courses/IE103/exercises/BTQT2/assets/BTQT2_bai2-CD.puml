@startuml "Bai 2. Class Diagram"

''skinparam classAttributeIconSize 0
skinparam defaultFontName "Iosevka"

class DaiLy {
  # maDaiLy: string
  - viTri: string
  + themNhanVien()
  + xoaNhanVien()
  + themHopDong()
}

' --- Các Class mới dựa theo ERD ---
class PhongBan {
  # maPB: string
  - tenPB: string
}

class ChucVu {
  # maCV: string
  - tenCV: string
}

' --- Inheritance (Kế thừa) ---
' NVKyThuat bay gio khong con giu 'chucVu' truc tiep
abstract class NhanVien {
  # maNV: string
  - tenNV: string
  - chucVu: string
  + nhanChucVu()
}
' NVHanhChanh khong con giu 'phongBan' truc tiep
class NVHanhChanh extends NhanVien {
  - trinhDoHocVan: string
  + lapHopDong()
  + duyetHopDong()
}
class NVKyThuat extends NhanVien {
  - bacTho: string
  - soNamKN: int
  + thucHienBaoHanh()
}
' ------------------

class KhachHang {
  # maKH: string
  - tenKH: string
  - diaChi: string
  - sdt: string
  + muaXe()
  + yeuCauBaoHanh()
}

class HopDong {
  # soHD: string
  - ngayHD: Date
  - thoiGianBH: string
  - tienPhaiTT: float
  - tienDaTT: float
  - giamTru: float
  + themXe()
  + themPhieuThanhToan()
  + tinhTienConLai()
}

class Xe {
  # soKhung: string
  # soSuon: string
  - nuocSX: string
  - loaiXe: string
  + themTieuSuBaoHanh()
}

class PhieuThanhToan {
  # maPTT: string
  - ngayTra: Date
  - soTien: float
}

class BaoHanh {
  # maBH: string
  - ngayYeuCau: Date
  - soKhung: string
  - soSuon: string
  + themChiTietBaoHanh()
  + giaoChoNhanVien()
}

class LinhKien {
  # maLK: string
  - tenLK: string
}

' --- Association Classes (Dựa trên ERD mới) ---

' ERD: CHUCVU_NHANVIEN (n-n)
class NhanChuc {
  ' Luu thong tin ve chuc vu cua nhan vien
  - ngayNhanChuc: Date
}

' ERD: THUCHIEN_BH (n-n)
' Mot bao hanh co the do nhieu NV Ky Thuat thuc hien
class ThucHienBaoHanh {
  - ngayThucHien: Date
}

' ERD: CHITIET_BH (n-n)
class ChiTietBaoHanh {
  - lyDo: string
  - loiThuocVe: string
  - giaTien: float
  + themLinhKien()
}

' --- Associations ---
DaiLy "1" -- "0..*" NhanVien : "có"

' --- Quan hệ mới theo ERD ---
' ERD: NV_PHONGBAN (1-n)
NhanVien "0..*" -- "1" PhongBan : "thuộc"

' ERD: CHUCVU_PHONGBAN (1-n)
ChucVu "0..*" -- "1" PhongBan : "thuộc"

' ERD: CHUCVU_NHANVIEN (n-n)
(NhanVien, NhanChuc) .. ChucVu
NhanVien "0..*" -- NhanChuc
NhanChuc -- "0..*" ChucVu

' --- Các quan hệ logic nghiệp vụ ---
KhachHang "1" -- "0..*" HopDong : "mua xe"
' Logic: Hop dong do NV Hanh Chanh dam nhiem
HopDong "0..*" -- "1" NVHanhChanh : "kế toán duyệt"
HopDong "0..*" -- "1" NVHanhChanh : "người lập"
HopDong "1" -- "1..*" Xe : "bao gồm"
HopDong "1" -- "1..3" PhieuThanhToan : "có"

' ERD: YEUCAU_BH (1-n)
Xe "1" -- "0..*" BaoHanh : "yêu cầu"
' ERD: CHITIET_BH (n-n)
(BaoHanh, ChiTietBaoHanh) .. LinhKien
BaoHanh "1" -- "0..*" ChiTietBaoHanh
ChiTietBaoHanh -- "1..*" LinhKien

' ERD: THUCHIEN_BH (n-n)
' Logic: Bao hanh do NV Ky Thuat thuc hien
(NVKyThuat, ThucHienBaoHanh) .. BaoHanh
NVKyThuat "0..*" -- ThucHienBaoHanh
ThucHienBaoHanh -- "0..*" BaoHanh

@enduml
