/*
Deployment script for IE103-BTTH2

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "IE103-BTTH2"
:setvar DefaultFilePrefix "IE103-BTTH2"
:setvar DefaultDataPath "/var/opt/mssql/data/"
:setvar DefaultLogPath "/var/opt/mssql/data/"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating Table [dbo].[CHUYENNGANH]...';


GO
CREATE TABLE [dbo].[CHUYENNGANH] (
    [MSCN]  INT           NOT NULL,
    [TENCN] NVARCHAR (30) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSCN] ASC)
);


GO
PRINT N'Creating Table [dbo].[GIAOVIEN]...';


GO
CREATE TABLE [dbo].[GIAOVIEN] (
    [MSGV]   INT           NOT NULL,
    [TENGV]  NVARCHAR (30) NOT NULL,
    [DIACHI] NVARCHAR (50) NOT NULL,
    [SODT]   VARCHAR (10)  NOT NULL,
    [MSHH]   INT           NOT NULL,
    [NAMHH]  SMALLDATETIME NOT NULL,
    PRIMARY KEY CLUSTERED ([MSGV] ASC)
);


GO
PRINT N'Creating Table [dbo].[GV_HDDT]...';


GO
CREATE TABLE [dbo].[GV_HDDT] (
    [MSGV] INT        NOT NULL,
    [MSDT] CHAR (6)   NOT NULL,
    [DIEM] FLOAT (53) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSGV] ASC, [MSDT] ASC)
);


GO
PRINT N'Creating Table [dbo].[GV_HV_CN]...';


GO
CREATE TABLE [dbo].[GV_HV_CN] (
    [MSGV] INT           NOT NULL,
    [MSHV] INT           NOT NULL,
    [MSCN] INT           NOT NULL,
    [NAM]  SMALLDATETIME NOT NULL,
    PRIMARY KEY CLUSTERED ([MSGV] ASC, [MSHV] ASC, [MSCN] ASC)
);


GO
PRINT N'Creating Table [dbo].[GV_PBDT]...';


GO
CREATE TABLE [dbo].[GV_PBDT] (
    [MSGV] INT        NOT NULL,
    [MSDT] CHAR (6)   NOT NULL,
    [DIEM] FLOAT (53) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSGV] ASC, [MSDT] ASC)
);


GO
PRINT N'Creating Table [dbo].[GV_UVDT]...';


GO
CREATE TABLE [dbo].[GV_UVDT] (
    [MSGV] INT        NOT NULL,
    [MSDT] CHAR (6)   NOT NULL,
    [DIEM] FLOAT (53) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSGV] ASC, [MSDT] ASC)
);


GO
PRINT N'Creating Table [dbo].[HOCHAM]...';


GO
CREATE TABLE [dbo].[HOCHAM] (
    [MSHH]  INT           NOT NULL,
    [TENHH] NVARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSHH] ASC)
);


GO
PRINT N'Creating Table [dbo].[HOCVI]...';


GO
CREATE TABLE [dbo].[HOCVI] (
    [MSHV]  INT           NOT NULL,
    [TENHV] NVARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSHV] ASC)
);


GO
PRINT N'Creating Table [dbo].[HOIDONG]...';


GO
CREATE TABLE [dbo].[HOIDONG] (
    [MSHD]      INT           NOT NULL,
    [PHONG]     INT           NOT NULL,
    [TGBD]      SMALLDATETIME NOT NULL,
    [NGAYHD]    SMALLDATETIME NOT NULL,
    [TINHTRANG] NVARCHAR (30) NULL,
    [MSGV]      INT           NULL,
    PRIMARY KEY CLUSTERED ([MSHD] ASC)
);


GO
PRINT N'Creating Table [dbo].[HOIDONG_DT]...';


GO
CREATE TABLE [dbo].[HOIDONG_DT] (
    [MSHD]      INT        NOT NULL,
    [MSDT]      CHAR (6)   NOT NULL,
    [QUYETDINH] NCHAR (10) NULL,
    CONSTRAINT [PK_HD_DT] PRIMARY KEY CLUSTERED ([MSHD] ASC, [MSDT] ASC)
);


GO
PRINT N'Creating Table [dbo].[HOIDONG_GV]...';


GO
CREATE TABLE [dbo].[HOIDONG_GV] (
    [MSHD] INT NOT NULL,
    [MSGV] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([MSHD] ASC, [MSGV] ASC)
);


GO
PRINT N'Creating Table [dbo].[SV_DETAI]...';


GO
CREATE TABLE [dbo].[SV_DETAI] (
    [MSSV] CHAR (8) NOT NULL,
    [MSDT] CHAR (6) NOT NULL,
    PRIMARY KEY CLUSTERED ([MSSV] ASC, [MSDT] ASC)
);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HH]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GIAOVIEN] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HH] FOREIGN KEY ([MSHH]) REFERENCES [dbo].[HOCHAM] ([MSHH]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HDDT_DT]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_HDDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HDDT_DT] FOREIGN KEY ([MSDT]) REFERENCES [dbo].[DETAI] ([MSDT]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HDDT_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_HDDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HDDT_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HV_CN_CN]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_HV_CN] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HV_CN_CN] FOREIGN KEY ([MSCN]) REFERENCES [dbo].[CHUYENNGANH] ([MSCN]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HV_CN_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_HV_CN] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HV_CN_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_HV_CN_HV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_HV_CN] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_HV_CN_HV] FOREIGN KEY ([MSHV]) REFERENCES [dbo].[HOCVI] ([MSHV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_PBDT_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_PBDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_PBDT_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_PBDT_DT]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_PBDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_PBDT_DT] FOREIGN KEY ([MSDT]) REFERENCES [dbo].[DETAI] ([MSDT]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_UVDT_DT]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_UVDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_UVDT_DT] FOREIGN KEY ([MSDT]) REFERENCES [dbo].[DETAI] ([MSDT]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_GV_UVDT_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[GV_UVDT] WITH NOCHECK
    ADD CONSTRAINT [FK_GV_UVDT_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_HD_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[HOIDONG] WITH NOCHECK
    ADD CONSTRAINT [FK_HD_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_HD_DT_DT]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[HOIDONG_DT] WITH NOCHECK
    ADD CONSTRAINT [FK_HD_DT_DT] FOREIGN KEY ([MSDT]) REFERENCES [dbo].[DETAI] ([MSDT]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_HD_DT_HD]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[HOIDONG_DT] WITH NOCHECK
    ADD CONSTRAINT [FK_HD_DT_HD] FOREIGN KEY ([MSHD]) REFERENCES [dbo].[HOIDONG] ([MSHD]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_HD_GV_HD]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[HOIDONG_GV] WITH NOCHECK
    ADD CONSTRAINT [FK_HD_GV_HD] FOREIGN KEY ([MSHD]) REFERENCES [dbo].[HOIDONG] ([MSHD]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_HD_GV_GV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[HOIDONG_GV] WITH NOCHECK
    ADD CONSTRAINT [FK_HD_GV_GV] FOREIGN KEY ([MSGV]) REFERENCES [dbo].[GIAOVIEN] ([MSGV]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SV_DETAI_DT]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[SV_DETAI] WITH NOCHECK
    ADD CONSTRAINT [FK_SV_DETAI_DT] FOREIGN KEY ([MSDT]) REFERENCES [dbo].[DETAI] ([MSDT]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SV_DETAI_SV]...';


GO
WAITFOR DELAY '00:00.010';

ALTER TABLE [dbo].[SV_DETAI] WITH NOCHECK
    ADD CONSTRAINT [FK_SV_DETAI_SV] FOREIGN KEY ([MSSV]) REFERENCES [dbo].[SINHVIEN] ([MSSV]);


GO
-- This file contains SQL statements that will be executed after the build script.
-- NOTE: This query runs under Azure Database Studio (ADS)
-- Use the master database explicitly.
USE master;
GO

-- Check if the database 'BTTH2' does NOT exist in the system records.
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'BTTH2')
BEGIN
    CREATE DATABASE BTTH2;
END
GO

-- Use the newly created db.
USE BTTH2;
GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[GIAOVIEN] WITH CHECK CHECK CONSTRAINT [FK_GV_HH];

ALTER TABLE [dbo].[GV_HDDT] WITH CHECK CHECK CONSTRAINT [FK_GV_HDDT_DT];

ALTER TABLE [dbo].[GV_HDDT] WITH CHECK CHECK CONSTRAINT [FK_GV_HDDT_GV];

ALTER TABLE [dbo].[GV_HV_CN] WITH CHECK CHECK CONSTRAINT [FK_GV_HV_CN_CN];

ALTER TABLE [dbo].[GV_HV_CN] WITH CHECK CHECK CONSTRAINT [FK_GV_HV_CN_GV];

ALTER TABLE [dbo].[GV_HV_CN] WITH CHECK CHECK CONSTRAINT [FK_GV_HV_CN_HV];

ALTER TABLE [dbo].[GV_PBDT] WITH CHECK CHECK CONSTRAINT [FK_GV_PBDT_GV];

ALTER TABLE [dbo].[GV_PBDT] WITH CHECK CHECK CONSTRAINT [FK_GV_PBDT_DT];

ALTER TABLE [dbo].[GV_UVDT] WITH CHECK CHECK CONSTRAINT [FK_GV_UVDT_DT];

ALTER TABLE [dbo].[GV_UVDT] WITH CHECK CHECK CONSTRAINT [FK_GV_UVDT_GV];

ALTER TABLE [dbo].[HOIDONG] WITH CHECK CHECK CONSTRAINT [FK_HD_GV];

ALTER TABLE [dbo].[HOIDONG_DT] WITH CHECK CHECK CONSTRAINT [FK_HD_DT_DT];

ALTER TABLE [dbo].[HOIDONG_DT] WITH CHECK CHECK CONSTRAINT [FK_HD_DT_HD];

ALTER TABLE [dbo].[HOIDONG_GV] WITH CHECK CHECK CONSTRAINT [FK_HD_GV_HD];

ALTER TABLE [dbo].[HOIDONG_GV] WITH CHECK CHECK CONSTRAINT [FK_HD_GV_GV];

ALTER TABLE [dbo].[SV_DETAI] WITH CHECK CHECK CONSTRAINT [FK_SV_DETAI_DT];

ALTER TABLE [dbo].[SV_DETAI] WITH CHECK CHECK CONSTRAINT [FK_SV_DETAI_SV];


GO
PRINT N'Update complete.';


GO
